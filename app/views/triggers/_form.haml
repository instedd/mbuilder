%div{'ng-app' => 'mbuilder'}
  - angular_templates "triggers/actions"
  - angular_templates "triggers/bindings"
  - angular_templates "triggers/pieces"

  %div{'ng-controller' => 'EditTriggerController', 'ng-init' => trigger_to_angular(application, trigger)}
    %div.row-fluid
      %div.span6
        %div
          %label{for: :name} Name
          %input{'ng-model' => 'name', type: :text, name: :name, autofocus: true}

        %div{'ng-controller' => 'TriggerController'}
          %div
            %label{for: :message} When a message like this
            .message-area{contenteditable: '{{contenteditable}}', 'ng-blur' => 'makeNotEditable($event)', 'ng-mouseup' => 'parseMessage($event)', 'ng-keydown' => 'handleMessageKey($event)'}
              %span.piece-container{'ng-repeat' => 'piece in pieces', 'ng-include' => true, 'src' => 'pieceTemplateFor(piece.kind)'}<>
              %span.last-piece<> &nbsp;

            is received from any
            .pill{draggable: 'true', dragstart: 'phoneNumberDragStart($event)'}
              phone number
            %br
            on any date at any time
          %br

        %div{'ng-controller' => 'ActionsController'}
          %div{'ng-repeat' => 'action in actions'}
            %div.action(ng-include src='actionTemplateFor(action.kind)')
            %br
          %div.new-action
            %a{'ng-click' => 'addSendMessageAction()', href: 'javascript:'} [+] Add "Send message" step
          %br

      %div.span6{'ng-controller' => 'TablesController'}
        %div
          %strong Tables
          %br
          %a{'ng-click' => 'newTable()', href: 'javascript:'} (+) New table
        %br

        %div{'ng-repeat' => 'table in tables', 'ng-controller' => 'TableController'}
          %div.logic-table
            %input{'ng-model' => 'table.name', type: :text}

            %table.table.table-bordered.fields
              %tr
                %td{'ng-repeat' => 'field in table.fields', 'ng-controller' => 'FieldController'}
                  %input.input-small{'ng-model' => 'field.name', dragover: 'dragOverName($event)', drop: 'dropOverName($event)', type: :text}
                %td
                  %a{'ng-click' => 'newField()', href: 'javascript:'} (+) New column

              %tr
                %td{'ng-repeat' => 'field in table.fields', 'ng-controller' => 'FieldController', dragover: 'dragOverValue($event)', drop: 'dropOverValue($event)'}
                  .empty-field{'ng-hide' => 'lookupFieldValue(table.guid, field.guid)'}
                    new value
                  .pill{'ng-show' => 'lookupFieldValue(table.guid, field.guid)'}
                    {{lookupFieldValue(table.guid, field.guid)}}
                %td
          %br

    %button.btn{'ng-click' => 'save()'} Save
