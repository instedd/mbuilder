%div{'ng-app' => 'mbuilder'}
  - angular_templates "shared/angular"
  - angular_templates "shared/actions"
  - angular_templates "shared/pieces"
  - angular_templates "shared/pills"

  %div{'ng-controller' => 'MessageTriggerController', 'ng-init' => message_trigger_to_angular(application, message_trigger)}
    %div{'ng-controller' => 'TriggerController'}
      %div.row-fluid
        %div.span6
          %div
            %label{for: :name} Name
            %input{'ng-model' => '$parent.name', type: :text, name: :name, autofocus: true}

          %div
            %label{for: :message} When a message like this is received:
            .message-container
              .from
                %strong From:
                .pill.bound{draggable: 'true', dragstart: 'phoneNumberDragStart($event)'}
                  {{from}}
              .message-area{contenteditable: '{{contenteditable}}', 'ng-blur' => 'makeNotEditable($event)', 'ng-mousedown' => 'makeEditable($event)', 'ng-mouseup' => 'parseMessage($event)', 'preserve-ng-repeat' => true}
                %span.piece-container{'ng-repeat' => 'piece in pieces', 'ng-include' => true, 'src' => 'pieceTemplateFor(piece.kind)'}<>
              .received-at
                %strong Received at:
                .pill.bound{draggable: 'true', dragstart: 'receivedAtDragStart($event)'}
                  dd-mm-yyyy

          = render 'shared/triggers/actions'
        = render 'shared/triggers/tables'

      %button.btn{'ng-click' => 'save()'} Save

      = render 'shared/triggers/popups'
