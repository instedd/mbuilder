%div{'ng-controller' => 'MessageTriggerController', 'ng-init' => message_trigger_to_angular(application, message_trigger)}
  %div{'ng-controller' => 'TriggerController'}
    .row-fluid
      .span6
        %div
          %label{for: :name} Name
          %input{'ng-model' => '$parent.name', type: :text, name: :name, autofocus: true}

        %div
          %label{for: :message} When a message like this is received:
          .message-container
            .from
              %strong From:
              .pill.bound{draggable: 'true', dragstart: 'phoneNumberDragStart($event)'}
                {{from}}
            .message-area{contenteditable: '{{contenteditable}}', 'ng-blur' => 'makeNotEditable($event)', 'ng-mousedown' => 'makeEditable($event)', 'ng-mouseup' => 'parseMessage($event)', 'preserve-ng-repeat' => true}
              %span.piece-container{'ng-repeat' => 'piece in pieces', 'ng-include' => true, 'src' => 'pieceTemplateFor(piece.kind)'}<>
            .received-at
              %strong Received at:
              .pill.bound{draggable: 'true', dragstart: 'receivedAtDragStart($event)'}
                yyyymmdd
        %br

        = render 'shared/triggers/actions'
      = render 'shared/triggers/tables'

    .row-fluid
      .span6
        %button.btn{'ng-click' => 'save()'} Save
        %button.btn.btn-link Cancel
        = icon_link_to :'icf-delete', 'Delete this trigger', '#', class: "pull-right"

    = render 'shared/triggers/popups'
